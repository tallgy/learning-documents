# 计算机网络

## 概述

### ISP

互联网第三阶段是形成了多层次ISP结构的互联网，ISP（Internet service provider），常被翻译为互联网服务提供商。（eg:中国电信，中国联通）

#### 基于ISP的多层结构的互联网的概念示意图

![image-20210831153752099](images/image-20210831153752099.png)

### ixp 互联网交换点

主要作用就是允许两个网络直接相连并交换分组

### 互联网的边缘部分

#### 端系统（主机）之间的通信方式可以划分为两大类：

##### 客户-服务器方式(C/S方式)

<img src="images/image-20210831154801034.png" alt="image-20210831154801034" style="zoom:50%;" />

最常用的，传统的方式

客户 (client) 和服务器 (server) 都是指通信中所涉及的两个应用进程。

客户是服务的请求方，服务器是服务的提供方。

###### 客户软件的特点：

被用户调用后运行，在打算通信时主动向远地服务器发起通信（请求服务）。因此，客户程序必须知道服务器程序的地址。

不需要特殊的硬件和很复杂的操作系统。

###### 服务器软件的特点：

一种专门用来提供某种服务的程序，可同时处理多个远地或本地客户的请求。

系统启动后即自动调用并一直不断地运行着，被动地等待并接受来自各地的客户的通信请求。因此，服务器程序不需要知道客户程序的地址。

一般需要强大的硬件和高级的操作系统支持。

##### 对等方式（P2P方式）

peer to peer

指两个主机在通信时并不区分哪一个是服务请求方还是服务提供方。

只要两个主机都运行了对等连接软件 (P2P 软件) ，它们就可以进行平等的、对等连接通信。

对等连接工作方式可支持大量对等用户（如上百万个）同时工作

<img src="images/image-20210831155057753.png" alt="image-20210831155057753" style="zoom:50%;" />

### 互联网的核心部分

路由器在网络核心部分起特殊作用，

**路由器是实现分组交换的关键构件**，其任务是转发收到的分组，这是网格核心部分的重要功能。

#### 电路交换的主要特点

这种必须经过

​		“建立连接(占用通信资源)

​		→通话(一直占用通信资源)

​		→释放连接(归还通信资源)”

三个步骤的交换方式称为电路交换。

**在通话的全部时间内，通话的两个用户始终占用端到端的通信资源**

#### 分组交换的主要特点

分组交换则采用**存储转发**技术。

表示把一个报文划分为几个分组后再进行传送。通常我们把要发送的整块数据称为一个**报文(message)**。

在发送报文之前，先把较长的报文划分成为一个个更小的等长数据段，例如，每个数据段为1024 bit。

在每一个 数据段前面，加上一些由必要的控制信息组成的**首部(header)**后，就构成了一个**分组(packet)**。分组又称为“**包”**，而分组的首部也可称**为“包头”。**

分组是在互联网中传送的数据单元。**分组中的“首部”是非常重要的**，正是由于分组的首部包**含了诸如目的地址和源地址等重要控制信息**，每一个分组才能在互联网中独立地选择传输路径，并被正确地交付到分组传输的终点。

![image-20210831160828530](images/image-20210831160828530.png)

位于**网络边缘的主机**和位于**网络核心部分的路由器**都是**计算机，**但它们**的作用却很不一样。**

**主机是为用户进行信息处理的**，并且可以和其他主机通过网络交换信息。

**路由器则是用来转发分组的**，即进行分组交换的。

路由器收到一个分组，先暂时存储一下，检查其首部，查找转发表，

按照首部中的目的地址，找到合适的接口转发出去，把分组交给下一一个路由器。

这样一步一步地(有时会经过几十个不同的路由器)以存储转发的方式，把分组交付最终的目的主机。

各路由器之间必须经常交换彼此掌握的路由信息，以便创建和动态维护路由器中的转发表，使得转发表能够在整个网络拓扑发生变化时及时更新。

<img src="images/image-20210831161057184.png" alt="image-20210831161057184" style="zoom:67%;" />

当我们讨论互联网的核心部分中的路由器转发分组的过程时，往往**把单个的网络简化成一条链路，而路由器成为核心部分的**结点，如图1-12(b)所示。 

这里要注意，路由器暂时存储的是一个个短分组，而不是整个的长报文。短分组是暂存在路由器的存储器(即内存)中而不是存储在磁盘中的。这就保证了较高的交换速率。

应当注意，分组交换在传送数据之前不必先占用一条端到端的链路的通信资源。分组在哪段链路上传送才占用这段链路的通信资源。

分组在传输时就**这样- - 段一段地断续占用通信**资源，而且还省**去了建立连接和释放连接的开销**，因而数据的传输**效率更高。**

互联网采取了专门的措施，保证了数据的传送具**有非常高的可靠性**(在第5章5.4节介绍运输层协议时要着重讨论这个问题)。当网络中的某些结**点或链路突然出现故障时**，在各路由器**中运行的路由选择协议(protocol)能**够自动找到转发分组最合适的路径。这些将在第4章4.5节中详细讨论。

##### 分组交换的优点

| 优点 | 所采用的手段                                                 |
| ---- | ------------------------------------------------------------ |
| 高效 | 在分组传输的过程中动态分配传输带宽，对通信链路是逐段占用     |
| 灵活 | 为每一个分组独立地选择最合适的转发路由                       |
| 迅速 | 以分组作为传送单位，可以不先建立连接就能向其他主机发送分组   |
| 可靠 | 保证可靠性的网络协议;分布式多路由的分组交换网，使网络有很好的生存性 |

##### 问题

例如，分组在各路由器存**储转发时需要排队，这**就会.造成一定的时延。因此，必须尽量设法减少这种时延。

此外，由于分组交换不像电路交换那样通过建立连接来保证**通信时所需的各种资源，因而无法确保通信时端到端所需的带宽。**

分组交换带来的另一个问题是各**分组必须携带的控制信息也造成了- -定的开销(overhead)。**整个分**组交换网还需要专门的管理和控制机制。**

#### 报文交换

基于存储转发原理，

##### 三种交换的比较

电路交换	——	整个报文的比特流连续地从源点直达终点，好像在一个管道中传送。
报文交换	——	整 个报文先传送到相邻结点，全部存储下来后查找转发表，转发到下一个结点。
分组交换	——	单个分组 (这只是整个报文的一部分)传送到相邻结点，存储下来后查找转发表，转发到下一一个结点。

<img src="images/image-20210831162415815.png" alt="image-20210831162415815" style="zoom:67%;" />

### 计算机网络的性能

#### 速率

我们知道，计算机发送出的信号都是数字形式的。**比特(bit)**来源于binary digit, 意思是一个“二进制数字”，因此一个**比特就是二进制数字中的一个1或0**。比特也是信息论中使用的信息量的单位。网络技术**中的速率指的是数据的传送速率**，它也称为**数据率(datarate)或比特率**(bit rate)。速率是计算机网络中最重要的一个性能指标。 速率的单位是bit/s (比特

#### 带宽

(1)带宽本来是指某个信号具有的频带宽度。

在计算机网络中，带宽表示单位时间内网络中的某信道所能通过的“最高数据率”。这种意义的带宽的单位就是数据率的单位bit/s，是“比特每秒”。

#### 吞吐量

#### 时延

**时延(delay或latency)**是指数据(一个报文或分组，甚至比特)从网络(或链路)的一端传送到另一端所需的时间。时延是个很重要的性能指标，它有时也称为**延迟或迟延。**

##### 发送时延

##### 传播时延

##### 处理时延

##### 排队时延

#### 时延带宽积

#### 往返时间rtt

#### 利用率

### 计算机网络体系结构

系统体系网络结构SNA

开放系统互连基本参考模型OSI/RM （open systems interconnection reference model）

法律国际标准OSI，没有得到广泛应用

非国际标准Tcp/IP， 事实上的国际标准

#### 分层的好处

**1）各层之间是独立的。**

**2）灵活性好。**

**3）结构上可分割开。**

**4）易于实现和维护。**

**5）能促进标准化工作。**

通常各层所要成的功能主要有以下一些(可以只包括一种，也可以包括多种):
**①差错控制**	使相应层次对等方的通信更加可靠。
**②流量控制**	发送端的发送速率必须使接收端来得及接收，不要太快。
**③分段和重装**	发送端将要发送的数据块划分为更小的单位，在接收端将其还原。
**④复用和分用**	发送端几个高层会话复用一条低层的连接，在接收端再进行分用。
**⑤连接建立和释放**	交换数据前先建立-条逻辑连接，数据传送结束后释放连接。.
分层当然也有一些**缺点**，例如，有些功能会在不同的层次中重复出现，因而产生了额外开销。

#### 具有五层协议的体系结构

OSI的七层协议体系结构(图1-18(a)) 的概念清楚，理论也较完整，但它既复杂又不实用。TCP/IP体系结构则不同，但它现在却得到了非常广泛的应用。

osi 七层	tcp 四层 	综合 5层

<img src="images/image-20210831164301870.png" alt="image-20210831164301870" style="zoom: 67%;" />

<img src="images/image-20210831164626086.png" alt="image-20210831164626086" style="zoom:67%;" />

##### 应用层 application layer

应用层是体系结构中的**最高层**。应用层的**任务是通过应用进程间的交互来完成特定网络应用**。应用层协议定义的是应用**进程间通信和交互的规则**。这里的进程就是指主机中正在运行的程序。对于不同的网络应用**需要有不同的应用层协议**。在互联网中的应用层协议很多，如域名系统**DNS**，支持万维网应用**的HTTP协**议，支持电子邮**件的SMTP协议，**等等。我们把应用层交互的数据单元称为**报文(message)。**

##### 运输层(transport layer)

运输层的任务就是负责向两台主机中进程**之间的通信提供通用的数据传输服务**。应用进程利用该服务传送应用层报文。所谓“通用的”，是指并不针对某个特定网络应用，而是多种应用可以使用同一个运输层服务。由于**一台主机可同时运行多个进程**，因此运输层有**复用和分用**的功能。**复用就是多个应用层进程可同时使用下面运输层的**服务，**分用和复用相反**，**是运输层把收到的信息分别交付**，上面应用层中的相应进程。

运输层使用以下两种协议

**传输控制协议TCP (Transmission Control Protocol**—— 提供**面 向连接的、可靠的数据传输**服务，其数据传输的单位是**报文段(segment)。**
**用户数据报协议UDP (User Datagram Protocol)**——提供无连接的、 尽最大努力(best-effort)的数据传输服务( 不保证数据传输的可靠性)，其数据传输的单位**是用户数据报。**

##### 网络层(network layer)

​		网络层负责为分组交换网.上的不同主机提供通信服务。在发送数据时，网络层把运输层产生的报文段或用户数据报封装成分组或包进行传送。在TCP/IP 体系中，**由于网络层使用IP协议，因此分组也叫做IP数据报**，或简称为数据报。本书把**“分组”和“数据报”**作为同义词使用。
​		请注意:不要将**运输层的“用户数据报UDP”和网络层的“IP数据报”弄混。**此外，无论在哪- -层传送的数据单元，都可笼统地用“分组”来表示。

​		网络层的另一个任务就**是要选择合适的路由**，使源主机运输层所传下来的分组，能够通过网络中的路由器找到目的主机。
​		这里要强调指出，网络层中的“网络”二字，已不是我们通常谈到的具体网络，而是在计算机网络体系结构模型中的第3层的名称。互联网是由**大量的异构(heterogeneous)网络通过路由器(router)相互连接起来**的。互联网使用的网络层协议是**无连接的网际协议IP (Internet Protocol)和许多种路由选择协议，因此互联网的网络层也叫做网际层或IP层。**在本书中，网络层、网际层和IP层都是同义语。

​		在位于不同地理位置的网络中的两个**主机系统之间提供连接和路径选择**。Internet的发展使得从世界各站点访问信息的用户数大大增加，**而网络层正是管理这种连接的层。** 　

##### 数据链路层(data link layer)

​		数据链路层常简称为**链路层**。我们知道，两台主机之间的数据传输，总是在一段一段的链路_上传送的，这就需要使用专门的链路层的协议。在两个相邻结点之间传送数据时，数据链路层将网络层**交下来的IP 数据报组装成帧(framing),**在两个相邻结点间的链路上**传送帧(frame)**。每- -帧包括数据和必要的**控制信息( 如同步信息、地址信息、差错控制等)。**
​		在接收数据时，控制信息使接收端能够知道--个帧从哪个比特开始和到哪个比特结束。这样，数据链路层在收到一个帧后，就可从中提取出数据部分，上交给网络层。
​		控制信息还使接收端能够检测到所收到的帧中有无差错。如发现有差错，数据链路层就简单地丢弃这个出了差错的帧，以免继续在网络中传送下去白白浪费网络资源。如果需要改正数据在数据链路层传输时出现的差错(这就是说，数据链路层不仅要检错，而且要纠错)，那么就要采用可靠传输协议来纠正出现的差错。这种方法会使数据链路层的协议复杂些。

​		定义了如何让**格式化数据以进行传输**，以及如何让控制对物理介质的访问。这一**层通常还提供错误检测和纠正，以**确保数据的可靠传输。 

##### 物理层 physical layer

​		主**要定义物理设备标准**，如网线的接口类型、光纤的接口类型、各种传输介质的传输速率等。它的主要作用**是传输比特流（就**是由1、0转化为电流强弱来进行传输,到达目的地后在转化为1、0，也就是我们常说的数模转换与模数转换）。这一层的数据**叫做比特。** 



​		现在人们经常经常提到的**tcp/ip**往往指的是互联网所使用的**整个 tcp/ip协议簇 protocol suite**

<img src="images/image-20210831170232924.png" alt="image-20210831170232924"  />

```
假定主机1的应用进程AP1向主机2的应用进程AP2传送数据。
AP1先将其数据交给本主机的第5层(应用层)。第5层加上必要的控制信息Hs就变成了下一层的数据单元。
第4层(运输层)收到这个数据单元后，加上本层的控制信息H4，
再交给第3层(网络层)，成为第3层的数据单元。
依此类推。不过到了第2层(数据链路层)后，控制信息被分成两部分，分别加到本层数据单元的首部(H2)和尾部(T2);
而第1层(物理层)由于是比特流的传送，所以不再加上控制信息。请注意，传送比特流时应从首部开始传送。
```

对等层，协议栈

#### 实体、协议、服务、服务访问点

​		当研究开放系统中的信息交换时，往往使用**实体(entity)**这一较为抽象的名词表示任何可发送或接收信息的硬件或软件进程。在许多情况下，实体就是-个特定的软件模块。
​		**协议是控制两个对等实体(或多个实体)进行通信的规则的集合**。协议的语法方面的规则**定义了所交换的信息的格式**，而协议的语义方面的规则就定义了发送者或接收者所要完成的操作，例如，在何种条件下，数据必须重传或丢弃。
​		在协议的控制下，**两个对等实体间的通信使得本层能够向上一层提供服**务。要实现本层协议，还需要使用**下面一层所提供的服务。**
​		一定 要弄清楚，协议和服务在概念上是很不-样的。
​		首先，**协议的实现保证了能够向上一层提供**服务。使用本层服务的**实体只能看见服务而无法看见下面**的协议。也就是说，下面的**协议对上面的实体是透明的。**
​		其次，**协议是“水平的”**，即协议是控制对等实体之间通信的规则。**但服务是“垂直的”**，即服务是由下层向上层通过层间接口提供的。另外，并非在**一个层内完成的全部功能都称为服务**。只有那些能**够被高- -层实体“看得见”的功能才能称之为“服务”**。上层使用下层所提供的服务必须通过与下层交换一些命令，这些命令在OSI中称为服务原语。

<img src="images/image-20210831170920510.png" alt="image-20210831170920510" style="zoom:67%;" />

#### tcp/IP体系结构

<img src="images/image-20210831170944985.png" alt="image-20210831170944985" style="zoom:67%;" />

<img src="images/image-20210831170954432.png" alt="image-20210831170954432" style="zoom:67%;" />

<img src="images/image-20210831171014369.png" alt="image-20210831171014369" style="zoom:67%;" />

### 本章的重要概念

​		计算机网络(可简称为网络)把许多计算机连接在一起，而互连网则把许多网络连接在一起，是网络的网络。
​		以小写字母i开始的intermet (互连网)是通用名词，它泛指由多个计算机网络互连而成的网络。在这些网络之间的通信协议(即通信规则)可以是任意的。
​		以大写字母I开始的Internet (互联网)是专用名词，它指当前全球最大的、开放的、由众多网络相互连接而成的特定互连网，并采用TCP/IP 协议族作为通信规则，且其前身是美国的ARPANET。Internet 的推荐译名是“因特网”，但很少被使用。
​		互联网现在采用存储转发的分组交换技术，以及三层ISP结构。.
​		互联网按工作方式可划分为边缘部分与核心部分。主机在网络的边缘部分，其作用是进行信息处理。路由器在网络的核心部分，其作用是按存储转发方式进行分组交换。
​		计算机通信是计算机中的进程(即运行着的程序)之间的通信。计算机网络采用的通信方式是客户-服务器方式和对等连接方式(P2P方式)。
​		客户和服务器都是指通信中所涉及的应用进程。客户是服务请求方，服务器是服务提供方。
​		按作用范围的不同，计算机网络分为广域网WAN.城域网MAN、局域网LAN和个人区域网PAN。
​		计算机网络最常用的性能指标是:速率、带宽、吞吐量、时延(发送时延、传播时延、处理时延、排队时延)、时延带宽积、往返时间和信道(或网络)利用率。
​		网络协议即协议，是为进行网络中的数据交换而建立的规则。计算机网络的各层及其协议的集合，称为网络的体系结构。
​		五层协议的体系结构由应用层、运输层、网络层(或网际层)、数据链路层和物理层组成。运输层最重要的协议是TCP和UDP协议，而网络层最重要的协议是IP 协议。









# end

## 参考

```
计算机网络 第7版 谢希仁
```

